class MaterialFields{constructor(){this.init()}init(){this.setupFields(),this.convertSelectsToCustom()}setupFields(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea");e.forEach(e=>{e.addEventListener("input",()=>this.handleInput(e)),e.addEventListener("focus",()=>this.handleFocus(e)),e.addEventListener("blur",()=>this.handleBlur(e)),"number"===e.type&&e.addEventListener("input",e=>{(e.target.value.includes("e")||e.target.value.includes("E"))&&(e.target.value=e.target.value.replace(/[eE][+-]?\d+/,""))}),this.updateFieldState(e),this.updateCounter(e)})}convertSelectsToCustom(){let e=document.querySelectorAll(".hb-material-field select");e.forEach(e=>{this.createCustomSelect(e)})}createCustomSelect(e){let t=e.closest(".hb-material-field"),l=e.getAttribute("data-placeholder")||e.options[0]?.text||"Seleccionar...",a=e.hasAttribute("required"),i=e.id,s=e.name||e.id,r=document.createElement("div");r.className="hb-material-select",r.setAttribute("tabindex","0"),r.setAttribute("data-value",e.value||""),a&&r.setAttribute("required",""),i&&(r.id=i),s&&r.setAttribute("data-name",s);let d=document.createElement("div");d.className="hb-material-select-trigger";let c=document.createElement("span");c.className="hb-material-select-value";let n=Array.from(e.options).find(e=>e.selected);n&&n.value?(c.textContent=n.text,r.setAttribute("data-value",n.value)):c.textContent="";let u=document.createElement("div");u.className="hb-material-select-arrow";let o=document.createElement("div");o.className="hb-material-select-panel",Array.from(e.options).forEach((e,t)=>{if(0===t&&""===e.value)return;let l=document.createElement("div");l.className="hb-material-option",l.setAttribute("data-value",e.value),l.textContent=e.text,e.selected&&l.classList.add("selected"),o.appendChild(l)}),d.appendChild(c),d.appendChild(u),r.appendChild(d),r.appendChild(o),e.style.display="none",e.parentNode.insertBefore(r,e),this.setupCustomSelectEvents(r,e,t,c,l),this.updateSelectState(r,t,c,l)}setupCustomSelectEvents(e,t,l,a,i){e.querySelector(".hb-material-select-trigger"),e.querySelector(".hb-material-select-panel");let s=e.querySelectorAll(".hb-material-option");e.addEventListener("click",t=>{t.stopPropagation(),document.querySelectorAll(".hb-material-select.open").forEach(t=>{t!==e&&t.classList.remove("open")}),e.classList.toggle("open")}),s.forEach(r=>{r.addEventListener("click",d=>{d.stopPropagation(),s.forEach(e=>e.classList.remove("selected")),r.classList.add("selected");let c=r.getAttribute("data-value");a.textContent=r.textContent,e.setAttribute("data-value",c),t.value=c,t.dispatchEvent(new Event("change")),this.updateSelectState(e,l,a,i),e.hasAttribute("required")&&l.classList.remove("invalid"),e.classList.remove("open")})}),e.addEventListener("focus",()=>{l.classList.add("focused"),this.updateSelectState(e,l,a,i)}),e.addEventListener("blur",()=>{l.classList.remove("focused"),l.classList.add("touched"),this.updateSelectState(e,l,a,i),this.validateSelect(e,l)}),e.addEventListener("keydown",t=>{"Enter"===t.key||" "===t.key?(t.preventDefault(),e.classList.toggle("open")):"Escape"===t.key&&e.classList.remove("open")}),document.addEventListener("click",()=>{e.classList.remove("open")})}updateSelectState(e,t,l,a){let i=e.getAttribute("data-value")&&""!==e.getAttribute("data-value");i?t.classList.add("filled"):(t.classList.remove("filled"),t.classList.contains("focused")||t.classList.contains("filled")?l.textContent=a:l.textContent="")}validateSelect(e,t){if(!t.classList.contains("touched"))return;let l=!0;e.hasAttribute("required")&&!e.getAttribute("data-value")&&(l=!1),l?t.classList.remove("invalid"):t.classList.add("invalid")}handleInput(e){this.updateCounter(e),this.updateFieldState(e),this.validateField(e)}handleFocus(e){e.closest(".hb-material-field").classList.add("focused")}handleBlur(e){let t=e.closest(".hb-material-field");t.classList.remove("focused"),t.classList.add("touched"),this.validateField(e)}updateFieldState(e){let t=e.closest(".hb-material-field"),l=e.value&&""!==e.value.trim();l?t.classList.add("filled"):t.classList.remove("filled")}updateCounter(e){let t=e.closest(".hb-material-field"),l=t.querySelector(".hb-material-char-counter");if(l){if("number"===e.type){let a=e.value?parseFloat(e.value):"",i=e.getAttribute("min"),s=e.getAttribute("max"),r=""!==a?a.toString():"0";s?r+=` / ${s}`:i&&(r+=` (m\xedn: ${i})`),l.textContent=r}else{let d=e.getAttribute("maxlength"),c=e.getAttribute("minlength"),n=e.value.length,u=`${n}`;d?u+=` / ${d}`:c&&n<c&&(u+=` (m\xedn: ${c})`),l.textContent=u}}}validateField(e){let t=e.closest(".hb-material-field");if(!t.classList.contains("touched"))return;let l=!0;if(e.hasAttribute("required")&&(!e.value||""===e.value.trim()))l=!1;else if(e.hasAttribute("minlength")&&e.value.length>0&&e.value.length<parseInt(e.getAttribute("minlength")))l=!1;else if(e.hasAttribute("maxlength")&&e.value.length>parseInt(e.getAttribute("maxlength")))l=!1;else if("number"===e.type&&e.value){let a=parseFloat(e.value),i=e.getAttribute("min"),s=e.getAttribute("max");i&&a<parseFloat(i)?l=!1:s&&a>parseFloat(s)&&(l=!1)}else"email"===e.type&&e.value?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)||(l=!1):e.validity.valid||(l=!1);l?t.classList.remove("invalid"):t.classList.add("invalid")}validateAll(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),l=!0;return e.forEach(e=>{let t=e.closest(".hb-material-field");t.classList.add("touched"),this.validateField(e),t.classList.contains("invalid")&&(l=!1)}),t.forEach(e=>{let t=e.closest(".hb-material-field");t.classList.add("touched"),this.validateSelect(e,t),t.classList.contains("invalid")&&(l=!1)}),l}getFormData(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),l=document.querySelectorAll('input[type="radio"]:checked'),a={};return e.forEach(e=>{e.id&&(a[e.id]=e.value)}),t.forEach(e=>{let t=e.getAttribute("data-name")||e.id;t&&(a[t]=e.getAttribute("data-value")||"")}),l.forEach(e=>{a[e.name]=e.value}),a}clearForm(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),l=document.querySelectorAll('input[type="radio"]');e.forEach(e=>{e.value="";let t=e.closest(".hb-material-field");t.classList.remove("filled","focused","touched","invalid");let l=t.querySelector(".hb-material-char-counter");l&&(l.textContent="0")}),t.forEach(e=>{e.setAttribute("data-value","");let t=e.closest(".hb-material-field"),l=e.querySelector(".hb-material-select-value");t.classList.remove("filled","focused","touched","invalid"),l.textContent="";let a=t.querySelector(".hb-material-char-counter");a&&(a.textContent=""),e.querySelectorAll(".hb-material-option").forEach(e=>e.classList.remove("selected"))}),l.forEach(e=>{e.checked=!1})}}window.materialFields=new MaterialFields;