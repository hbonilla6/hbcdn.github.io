class MaterialFields{constructor(){this.init()}init(){this.setupFields(),this.convertSelectsToCustom(),this.detectInitialDisabledFields()}setupFields(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea");e.forEach(e=>{e.addEventListener("input",()=>this.handleInput(e)),e.addEventListener("focus",()=>this.handleFocus(e)),e.addEventListener("blur",()=>this.handleBlur(e)),"number"===e.type&&e.addEventListener("input",e=>{(e.target.value.includes("e")||e.target.value.includes("E"))&&(e.target.value=e.target.value.replace(/[eE][+-]?\d+/,""))}),this.updateFieldState(e),this.updateCounter(e),this.updateDisabledState(e)})}convertSelectsToCustom(){let e=document.querySelectorAll(".hb-material-field select");e.forEach(e=>{this.createCustomSelect(e)})}createCustomSelect(e){let t=e.closest(".hb-material-field"),a=e.getAttribute("data-placeholder")||e.options[0]?.text||"Seleccionar...",l=e.hasAttribute("required"),i=e.hasAttribute("disabled"),s=e.id,r=e.name||e.id,d=document.createElement("div");d.className="hb-material-select",d.setAttribute("tabindex",i?"-1":"0"),d.setAttribute("data-value",e.value||""),l&&d.setAttribute("required",""),i&&d.setAttribute("disabled",""),s&&(d.id=s),r&&d.setAttribute("data-name",r);let u=document.createElement("div");u.className="hb-material-select-trigger";let c=document.createElement("span");c.className="hb-material-select-value";let o=Array.from(e.options).find(e=>e.selected);o&&o.value?(c.textContent=o.text,d.setAttribute("data-value",o.value)):c.textContent="";let n=document.createElement("div");n.className="hb-material-select-arrow";let b=document.createElement("div");b.className="hb-material-select-panel",Array.from(e.options).forEach((e,t)=>{if(0===t&&""===e.value)return;let a=document.createElement("div");a.className="hb-material-option",a.setAttribute("data-value",e.value),a.textContent=e.text,e.selected&&a.classList.add("selected"),b.appendChild(a)}),u.appendChild(c),u.appendChild(n),d.appendChild(u),d.appendChild(b),e.style.display="none",e.parentNode.insertBefore(d,e),this.setupCustomSelectEvents(d,e,t,c,a),this.updateSelectState(d,t,c,a),this.updateSelectDisabledState(d,t)}setupCustomSelectEvents(e,t,a,l,i){e.querySelector(".hb-material-select-trigger"),e.querySelector(".hb-material-select-panel");let s=e.querySelectorAll(".hb-material-option");e.addEventListener("click",t=>{e.hasAttribute("disabled")||(t.stopPropagation(),document.querySelectorAll(".hb-material-select.open").forEach(t=>{t!==e&&t.classList.remove("open")}),e.classList.toggle("open"))}),s.forEach(r=>{r.addEventListener("click",d=>{if(e.hasAttribute("disabled"))return;d.stopPropagation(),s.forEach(e=>e.classList.remove("selected")),r.classList.add("selected");let u=r.getAttribute("data-value");l.textContent=r.textContent,e.setAttribute("data-value",u),t.value=u,t.dispatchEvent(new Event("change")),this.updateSelectState(e,a,l,i),e.hasAttribute("required")&&a.classList.remove("invalid"),e.classList.remove("open")})}),e.addEventListener("focus",()=>{e.hasAttribute("disabled")||(a.classList.add("focused"),this.updateSelectState(e,a,l,i))}),e.addEventListener("blur",()=>{e.hasAttribute("disabled")||(a.classList.remove("focused"),a.classList.add("touched"),this.updateSelectState(e,a,l,i),this.validateSelect(e,a))}),e.addEventListener("keydown",t=>{e.hasAttribute("disabled")||("Enter"===t.key||" "===t.key?(t.preventDefault(),e.classList.toggle("open")):"Escape"===t.key&&e.classList.remove("open"))}),document.addEventListener("click",()=>{e.classList.remove("open")})}updateSelectState(e,t,a,l){let i=e.getAttribute("data-value")&&""!==e.getAttribute("data-value");i?t.classList.add("filled"):(t.classList.remove("filled"),t.classList.contains("focused")||t.classList.contains("filled")?a.textContent=l:a.textContent="")}updateSelectDisabledState(e,t){e.hasAttribute("disabled")?(t.classList.add("disabled"),e.setAttribute("tabindex","-1")):(t.classList.remove("disabled"),e.setAttribute("tabindex","0"))}validateSelect(e,t){if(!t.classList.contains("touched"))return;let a=!0;e.hasAttribute("required")&&!e.getAttribute("data-value")&&(a=!1),a?t.classList.remove("invalid"):t.classList.add("invalid")}handleInput(e){!(e.hasAttribute("disabled")||e.hasAttribute("readonly"))&&(this.updateCounter(e),this.updateFieldState(e),this.validateField(e))}handleFocus(e){!e.hasAttribute("disabled")&&e.closest(".hb-material-field").classList.add("focused")}handleBlur(e){if(e.hasAttribute("disabled"))return;let t=e.closest(".hb-material-field");t.classList.remove("focused"),t.classList.add("touched"),this.validateField(e)}updateFieldState(e){let t=e.closest(".hb-material-field"),a=e.value&&""!==e.value.trim();a?t.classList.add("filled"):t.classList.remove("filled")}updateDisabledState(e){let t=e.closest(".hb-material-field");e.hasAttribute("disabled")?(t.classList.add("disabled"),("date"===e.type||"datetime-local"===e.type||"time"===e.type)&&(e.style.backgroundColor="#f5f5f5",e.style.color="#4e4e4e",e.style.borderColor="#e0e0e0")):(t.classList.remove("disabled"),("date"===e.type||"datetime-local"===e.type||"time"===e.type)&&(e.style.backgroundColor="",e.style.color="",e.style.borderColor="")),e.hasAttribute("readonly")?t.classList.add("readonly"):t.classList.remove("readonly")}updateCounter(e){let t=e.closest(".hb-material-field"),a=t.querySelector(".hb-material-char-counter");if(a){if("number"===e.type){let l=e.value?parseFloat(e.value):"",i=e.getAttribute("min"),s=e.getAttribute("max"),r=""!==l?l.toString():"0";s?r+=` / ${s}`:i&&(r+=` (m\xedn: ${i})`),a.textContent=r}else{let d=e.getAttribute("maxlength"),u=e.getAttribute("minlength"),c=e.value.length,o=`${c}`;d?o+=` / ${d}`:u&&c<u&&(o+=` (m\xedn: ${u})`),a.textContent=o}}}validateField(e){let t=e.closest(".hb-material-field");if(!t.classList.contains("touched")||e.hasAttribute("disabled"))return;let a=!0;if(e.hasAttribute("required")&&(!e.value||""===e.value.trim()))a=!1;else if(e.hasAttribute("minlength")&&e.value.length>0&&e.value.length<parseInt(e.getAttribute("minlength")))a=!1;else if(e.hasAttribute("maxlength")&&e.value.length>parseInt(e.getAttribute("maxlength")))a=!1;else if("number"===e.type&&e.value){let l=parseFloat(e.value),i=e.getAttribute("min"),s=e.getAttribute("max");i&&l<parseFloat(i)?a=!1:s&&l>parseFloat(s)&&(a=!1)}else"email"===e.type&&e.value?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)||(a=!1):e.validity.valid||(a=!1);a?t.classList.remove("invalid"):t.classList.add("invalid")}detectInitialDisabledFields(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea");e.forEach(e=>{(e.hasAttribute("disabled")||e.hasAttribute("readonly"))&&this.updateDisabledState(e)});let t=document.querySelectorAll(".hb-material-field select");t.forEach(e=>{let t=e.closest(".hb-material-field"),a=t.querySelector(".hb-material-select");e.hasAttribute("disabled")&&a&&(a.setAttribute("disabled",""),this.updateSelectDisabledState(a,t))})}setFieldDisabled(e,t=!0){let a=document.getElementById(e);if(!a)return;let l=a.closest(".hb-material-field");if("INPUT"===a.tagName||"TEXTAREA"===a.tagName)t?a.setAttribute("disabled",""):a.removeAttribute("disabled"),this.updateDisabledState(a);else{let i=l.querySelector(".hb-material-select");i&&(t?i.setAttribute("disabled",""):i.removeAttribute("disabled"),this.updateSelectDisabledState(i,l))}}setFieldReadonly(e,t=!0){let a=document.getElementById(e);a&&("INPUT"===a.tagName||"TEXTAREA"===a.tagName)&&(t?a.setAttribute("readonly",""):a.removeAttribute("readonly"),this.updateDisabledState(a))}validateAll(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),a=!0;return e.forEach(e=>{if(e.hasAttribute("disabled"))return;let t=e.closest(".hb-material-field");t.classList.add("touched"),this.validateField(e),t.classList.contains("invalid")&&(a=!1)}),t.forEach(e=>{if(e.hasAttribute("disabled"))return;let t=e.closest(".hb-material-field");t.classList.add("touched"),this.validateSelect(e,t),t.classList.contains("invalid")&&(a=!1)}),a}getFormData(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),a=document.querySelectorAll('input[type="radio"]:checked'),l={};return e.forEach(e=>{e.id&&(l[e.id]=e.value)}),t.forEach(e=>{let t=e.getAttribute("data-name")||e.id;t&&(l[t]=e.getAttribute("data-value")||"")}),a.forEach(e=>{l[e.name]=e.value}),l}clearForm(){let e=document.querySelectorAll(".hb-material-field input, .hb-material-field textarea"),t=document.querySelectorAll(".hb-material-field .hb-material-select"),a=document.querySelectorAll('input[type="radio"]');e.forEach(e=>{if(e.hasAttribute("disabled")||e.hasAttribute("readonly"))return;e.value="";let t=e.closest(".hb-material-field");t.classList.remove("filled","focused","touched","invalid");let a=t.querySelector(".hb-material-char-counter");a&&(a.textContent="0")}),t.forEach(e=>{if(e.hasAttribute("disabled"))return;e.setAttribute("data-value","");let t=e.closest(".hb-material-field"),a=e.querySelector(".hb-material-select-value");t.classList.remove("filled","focused","touched","invalid"),a.textContent="";let l=t.querySelector(".hb-material-char-counter");l&&(l.textContent=""),e.querySelectorAll(".hb-material-option").forEach(e=>e.classList.remove("selected"))}),a.forEach(e=>{!e.hasAttribute("disabled")&&(e.checked=!1)})}}