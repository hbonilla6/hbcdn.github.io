function inicializarFormulariosHbHbx(e){let t=h(e).find("[data-val-required], [required]");function n(e,t,n){let a=e.data(t);return function(...t){"function"==typeof window[a]?window[a](...t,e):n(...t,e)}}function a(e,t,n,a){toast({icon:tToast.success,title:"Operaci\xf3n realizada correctamente"}),"false"!==a.attr("data-hb-close-modal")&&i(a)}function l(e,t,n,a){i(a),h.error("Error en la solicitud AJAX:",n);let l=e.responseText,r=document.createElement("div");r.innerHTML=l,l=r.innerHTML,Swal.fire({icon:"error",html:l||"Error desconocido",showConfirmButton:!0})}function r(e,t,n){n.find("button").prop("disabled",!1)}function i(e){let t=$(e).closest(".modal");t.length&&(t.modal("hide"),t.removeClass("show"),t.css("display","none"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("body").css("padding-right",""))}t.count>0&&(toastR({title:"Los elementos marcados con <b style='color: red; font-size: x-large;'>*</b> son obligatorios.",type:tToast.info}),t.each(e=>{let t=document.querySelector(`label[for="${e.id}"]:not(.label-not-required)`);t?t.classList.add("label-required"):e.id||h.warn('Elemento con `data-val-required` no tiene un atributo "id":',e)})),$(e).off("submit").on("submit",function(e){e.preventDefault();let t=$(this),i=t.data("hb-confirm")||"\xbfEst\xe1s seguro de realizar esta acci\xf3n?",o=[...this.querySelectorAll("[data-val-required], [required]")].filter(e=>!e.value.trim()||!e.checkValidity()||"true"===e.getAttribute("aria-invalid"));return o.length>0?(h.groupCollapsed("Campos Requeridos Inv\xe1lidos:"),o.forEach(e=>{let t=e.labels?.[0]?.textContent?.trim()||e.name?.trim()||"Sin etiqueta";h.error(`- ${t}`),e.focus()}),h.groupEnd(),!1):(Swal.fire({title:i,icon:"question",showCancelButton:!0,confirmButtonText:"S\xed, continuar",cancelButtonText:"Cancelar"}).then(e=>{var i,o;e.isConfirmed?(addCurrentPathToForm(t[0]),i=t,$.ajax({url:i.attr("action"),method:i.attr("method"),data:new FormData(i[0]),processData:!1,contentType:!1,beforeSend:(o=i,function(e,t){let n=o.data("hb-before");"function"==typeof window[n]?window[n](e,t,o):function e(t){t.find("button").prop("disabled",!0)}(o)}),success:n(i,"hb-success",a),error:n(i,"hb-error",l),complete:n(i,"hb-complete",r)})):toast({title:"&#161;Acci&oacute;n cancelada!",icon:tToast.info})}),!1)})}const actionPresets={post:{successTitle:"Registro Agregado",errorTitle:"Error al Agregar",confirmTitle:"\xbfDeseas agregar este registro?",confirmText:"Esta acci\xf3n agregar\xe1 un nuevo elemento",confirmColor:"#28a745",cancelColor:"#6c757d",confirmButtonText:"Agregar",cancelButtonText:"Cancelar"},put:{successTitle:"Registro Modificado",errorTitle:"Error al Modificar",confirmTitle:"\xbfDeseas modificar este registro?",confirmText:"Esta acci\xf3n actualizar\xe1 la informaci\xf3n existente",confirmColor:"#17a2b8",cancelColor:"#6c757d",confirmButtonText:"Modificar",cancelButtonText:"Cancelar"},delete:{successTitle:"Registro Eliminado",errorTitle:"Error al Eliminar",confirmTitle:"\xbfEst\xe1s seguro de eliminar?",confirmText:"Esta acci\xf3n no se puede deshacer",confirmColor:"#dc3545",cancelColor:"#6c757d",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}};function initializeAjaxForm(e,t={}){let n={successTitle:"Operaci\xf3n exitosa",errorTitle:"Ocurri\xf3 un error al enviar el formulario",confirmTitle:"\xbfEst\xe1s seguro?",confirmText:"\xbfDeseas enviar el formulario?",renderTarget:"#renderBody",...t};$(e).each(function(){let e=$(this)[0],t=$(e).attr("hb-action"),a=actionPresets[t]||{};$(e).attr("hb-success-title")||a.successTitle||n.successTitle;let l=$(e).attr("hb-error-title")||a.errorTitle||n.errorTitle,r=$(e).attr("hb-confirm-title")||a.confirmTitle||n.confirmTitle,i=$(e).attr("hb-confirm-text")||a.confirmText||n.confirmText,o=$(e).attr("hb-confirm-color")||a.confirmColor||"#4caf50",s=$(e).attr("hb-cancel-color")||a.cancelColor||"#d33",c=$(e).attr("hb-confirm-button-text")||a.confirmButtonText||"Confirmar",d=$(e).attr("hb-cancel-button-text")||a.cancelButtonText||"Cancelar",u=e.querySelectorAll("[data-val-required], [required]");u.length>0&&(toastR({title:"Los elementos marcados con <b style='color: red; font-size: x-large;'>*</b> son obligatorios.",type:tToast.info}),u.forEach(e=>{let t=document.querySelector(`label[for="${e.id}"]:not(.label-not-required)`);t?t.classList.add("label-required"):e.id||h.warn('Elemento con `data-val-required` no tiene un atributo "id":',e)})),$(e).submit(function(e){e.preventDefault();let t=e.target;$(t).valid();let a=[...t.querySelectorAll("[data-val-required], [required]")].filter(e=>!e.value.trim()||"function"==typeof isValidElement&&!isValidElement(e)||"true"===e.getAttribute("aria-invalid"));if(a.length>0)return h.groupCollapsed("Campos Requeridos Inv\xe1lidos:"),a.forEach((e,t)=>{let n=e.labels?.[0]?.textContent?.trim()||e.name?.trim()||"Sin etiqueta";h.error(`- ${n}`),0===t&&e.focus()}),h.groupEnd(),!1;swalConfirmation({type:tToast.confirm,title:r,text:i,options:{buttons:{cancel:{show:!0,text:d,color:s},confirm:{text:c,color:o},deny:{show:!1}},onConfirm:function(){showLoadingAlert(!0);let e=("function"!=typeof convertCase||convertCase())&&("function"!=typeof verifyIntlTelInput||verifyIntlTelInput());e?$.ajax({url:$(t).attr("action"),type:$(t).attr("method"),data:new FormData(t),processData:!1,contentType:!1,success:function(e){onSuccessAlert(n)},error:function(e,t,n){h.error("Error en la solicitud AJAX:",n);let a=e.responseText,r=document.createElement("div");r.innerHTML=a,a=r.innerHTML,Swal.fire({icon:"error",title:l,html:a||"Error desconocido",showConfirmButton:!0})}}):(showLoadingAlert(!1),h.warn("Fall\xf3 la validaci\xf3n de convertCase() o verifyIntlTelInput()"))}}})})})}function normalizeText(e,t=null){return(e=(e=(e=(e=e.normalize("NFD")).replace(/[\u0300-\u036f]/g,"")).replace(/[^a-zA-Z0-9\s]/g,"")).trim(),!1===t)?e.toLowerCase():!0===t?e.toUpperCase():e.trim()}function toDecimal(e,t=0,n=2){n=Math.max(0,Math.trunc(n));let a=parseFloat(e);return isNaN(a)&&(a=t),parseFloat(a.toFixed(n))}function toInt(e,t=0){let n=parseInt(e,10);return isNaN(n)&&(n=t),n}function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function convertCase(){let e=document.getElementsByClassName("text-uppercase");for(let t of e)("INPUT"===t.tagName||"TEXTAREA"===t.tagName)&&(t.value=t.value.toUpperCase());return!0}function veriryIntlTelInput(){return h('input[type="tel"][data-jq-toggle="inputTel"]')?.each((e,t)=>{var n=window.intlTelInputGlobals.getInstance(t);let a=n.getNumber();a&&$(t).focus()}),!0}function requestAsync({url:e,id:t,method:n="GET",callback:a}){try{let l=toast({icon:tToast.info,position:tToasPosition.bottomStart,title:"Cargando...",timer:1e4}),r=document.getElementById(t);if(r){let i=r.tagName||"";switch(i){case"SELECT":r.innerHTML="<option disabled selected value=''>Cargando...</option>";break;case"DIV":"modalContent"===r.id?r.innerHTML="<div class='overlay'><i class='fas fa-2x fa-sync fa-spin'></i></div>":r.innerHTML="<progress></progress>";break;default:r.innerHTML="<progress></progress>"}}let o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){let t=toastMap.get(l);if(t&&(t.close(),toastMap.delete(l)),200===o.status){if(r){r.innerHTML=o.responseText;if(null!=r.querySelector("form[data-signin]")){window.location.reload();return}}"function"==typeof a&&a(o)}else handleRequestError(e)}},o.open(n,e,!0),o.send()}catch(s){h.error(s),handleRequestError(e)}}function handleRequestError(e){let t=e.split("/");if(t.length<4){h.error(`Error: URL incompleta: ${e}`);return}let n=getSegmentWithoutQuery(t[4]),a=t[3];h.error(`${n} => ${a}`)}function getSegmentWithoutQuery(e){return e.split("?")[0]}function disableAllSubmitButtons(e,t=!0){h(e).find("[type='submit']").each((e,n)=>{n.disabled=t})}function getFullPath(){return window.location.pathname+window.location.search}function addCurrentPathToForm(e){if(!e||!(e instanceof HTMLFormElement)){h.error("Se requiere un elemento form v\xe1lido");return}let t=getFullPath(),n=e.querySelector('input[name="currentPath"]');if(n)n.value=t;else{let a=document.createElement("input");a.type="hidden",a.name="currentPath",a.value=t,e.insertBefore(a,e.firstChild)}}function validateForm(e){return(showLoadingAlert(!0),"loading"===document.readyState&&swalTimer({}),convertCase()&&veriryIntlTelInput())?(addCurrentPathToForm(e),showLoadingAlert(!1),e.submit()):(showLoadingAlert(!1),!1)}function confirmForm(e){let t=e.target;e.preventDefault();let n=[...t.querySelectorAll("[data-val-required], [required]")].filter(e=>!e.value.trim()||!isValidElement(e)||"true"===e.getAttribute("aria-invalid"));return n.length>0?(h.groupCollapsed("Campos Requeridos Inv\xe1lidos:"),n.forEach(e=>{let t=e.labels?.[0]?.textContent?.trim()||e.name?.trim()||"Sin etiqueta";h.error(`- ${t}`),e.focus()}),h.groupEnd(),!1):(swalConfirmation({type:tToast.confirm,title:"\xbfDesea confirmar?",options:{buttons:{deny:{show:!1},confirm:{color:"#4caf50"}},onConfirm:function(){validateForm(t)}}}),!1)}function checkRequiredElements(e){let t=e.querySelectorAll("[data-val-required], [required]");t.length>0&&(toastR({title:"Los elementos marcados con <b style='color: red; font-size: x-large;'>*</b> son obligatorios.",type:tToast.info}),t.forEach(e=>{let t=document.querySelector(`label[for="${e.id}"]:not(.label-not-required)`);t?t.classList.add("label-required"):e.id||h.warn('Elemento con `data-val-required` no tiene un atributo "id":',e)})),e.addEventListener("submit",confirmForm)}function isValidElement(e){return e.checkValidity()}function onSelect2(){$.fn.select2.defaults.set("language","es");$("select.select2").select2(),$(".select2").on("select2:selecting",function(e){h(`[data-valmsg-for="${e.params.args.data.element.closest("select").name}"]`)?.html("")})}function simplePostUnobtrusiveAjax(){h("*[data-post-simple='true']").attr("data-ajax","true").attr("data-ajax-method","POST").attr("data-ajax-success","onSuccessAlert").attr("data-ajax-begin","onBegin").attr("data-ajax-complete","hideLoadingAlert")}function onSelect2Individual(e){try{let t=!1,n=$(`select.select2#${e}`),a=n.hasClass("select2-hidden-accessible");a&&(t=n.select2("isOpen")),n.select2(),t&&n.select2("open")}catch(l){}}function initialFunctions(e={}){h("form[data-verify-form='true']").each(e=>checkRequiredElements(e)),h("input:not([data-exclude-apply]), select:not([data-exclude-apply]), textarea:not([data-exclude-apply]), [contenteditable]:not([data-exclude-apply])").on("keydown",handleEnterAsTab),handleNumberInput(),applyAttributes(),initImageUpload(),initializeAjaxForm("form[hb-catalog]",e),inicializarFormulariosHbHbx("form[hb-hbx]"),onSelect2(),generatehbqrs()}function utilityModal(e,t,n={}){requestAsync({url:`${e}`,id:"modalContent",callback:function(){h.info("completed utility modal"),initialFunctions(n);let e=document.querySelector("#modal-overlay");if(e){if("undefined"!=typeof bootstrap){document.querySelectorAll(".modal-backdrop").forEach(e=>e.remove());let a=new bootstrap.Modal(e);a.show()}let l=e.querySelector('input[type="text"]:not([type="hidden"]):not([disabled]), textarea:not([disabled])');l?(l.focus(),l.setSelectionRange&&l.setSelectionRange(l.value.length,l.value.length),l.scrollIntoView({behavior:"smooth",block:"start"})):h.warn("No focusable elements found in form")}else h.warn("Modal element not found");$.validator.unobtrusive.parse("#modalContent"),t&&t()}})}function verifyWhatsApp(e,t=null){t||(t=e.value);let n=String(t).replace(/[\s-]/g,""),a=h(e).closest(".icon-input-container").find(".input-icon").get(0);n?h(a).removeClass("text-dark").addClass("text-success,text-shadow-success").attr("target","_blank").attr("href",`https://wa.me/${n}`):h(a).removeClass("text-success,text-shadow-success").addClass("text-dark").removeAttr("target").attr("href","#")}function formatInputOnBlur(e,t=2){let n=e.value.replace(/\D/g,"");n.length>0&&(n=n.padStart(t,"0")),e.value=n}function togglePassword(e,t){var n=e.previousElementSibling;t?n.setAttribute("type","text"):n.setAttribute("type","password")}function onBegin(){}let alertLoading;function showLoadingAlert(e=!0){e?(alertLoading=Swal.fire({html:`
        <div class="loading-container">
          <p class="loading-text">Cargando<span class="dots"></span></p>
          <div class="loading-animation">
            <div class="spinner">
              <div class="bounce1"></div>
              <div class="bounce2"></div>
              <div class="bounce3"></div>
            </div>
          </div>
        </div>
      `,showConfirmButton:!1,allowOutsideClick:!1,didOpen(){let e=document.createElement("style");e.innerHTML=`
          .loading-container {
            padding: 10px;
          }
          .loading-text {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
          }
          .dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
          }
          @keyframes dots {
            0%, 20% {
              content: '.';
            }
            40% {
              content: '..';
            }
            60%, 80% {
              content: '...';
            }
            100% {
              content: '';
            }
          }
          .loading-animation {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
          }
          .spinner {
            margin: 0 auto;
            width: 70px;
            text-align: center;
          }
          .spinner > div {
            width: 18px;
            height: 18px;
            background-color: #3085d6;
            border-radius: 100%;
            display: inline-block;
            margin: 0 3px;
            animation: sk-bouncedelay 1.4s infinite ease-in-out both;
          }
          .spinner .bounce1 {
            animation-delay: -0.32s;
          }
          .spinner .bounce2 {
            animation-delay: -0.16s;
          }
          @keyframes sk-bouncedelay {
            0%, 80%, 100% { 
              transform: scale(0);
            } 
            40% { 
              transform: scale(1.0);
            }
          }
        `,document.head.appendChild(e)}}),document.querySelectorAll("input[type='submit'], button[type='submit']").forEach(e=>{e.setAttribute("disabled",!0)})):(alertLoading&&Swal.close(),document.querySelectorAll("input[type='submit'], button[type='submit']").forEach(e=>{e.removeAttribute("disabled")}))}function onSuccessAlert(e){let t=getFullPath();return $.ajax({url:t,type:"GET",data:{isPartial:!0},success:function(t){$(e.renderTarget).html(t),$(".modal").modal("hide"),$(".modal").hide(),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),showLoadingAlert(!1),Swal.fire({icon:"success",title:e.successTitle,text:e.successMsg,showConfirmButton:!1,timer:1500})},error:function(e){alert("Error",e)}}),!1}function hideLoadingAlert(){return showLoadingAlert(!1),!1}function toDecimal(e,t=0,n=2){n=Math.max(0,Math.trunc(n));let a=parseFloat(e);return isNaN(a)&&(a=t),parseFloat(a.toFixed(n))}function toInt(e,t=0){let n=parseInt(e,10);return isNaN(n)&&(n=t),n}function applyAttributes(){h("*[data-disabled='true']")?.disabled(!0),h("*[data-checked='true']")?.checked(!0),h("*[data-readonly='true']")?.readonly(!0),h("*[data-hidden='true']")?.hidden(!0),h("*[data-interactive='false']")?.pointerEvents(!1)}const actionFunctions={};function addActionFunction(e,t){"string"==typeof e&&"function"==typeof t?actionFunctions[e]=t:h.error("El nombre de la funci\xf3n debe ser un string y la implementaci\xf3n debe ser una funci\xf3n.")}function handleCards(e,t=[]){if(e){let n=document.getElementById(e);if(n){n.classList.remove("collapsed-card");let a=n.querySelector(".card-body");a&&(a.style.display="block");let l=n.querySelector(".card-tools .btn-tool i");l&&(l.classList.remove("fa-plus"),l.classList.add("fa-minus"))}}let r=0===t.length?document.querySelectorAll(".card"):t;r.forEach(t=>{let n="string"==typeof t?document.getElementById(t):t;if(n&&n!==document.getElementById(e)){n.classList.add("collapsed-card");let a=n.querySelector(".card-body");a&&(a.style.display="none");let l=n.querySelector(".card-tools .btn-tool i");l&&(l.classList.remove("fa-minus"),l.classList.add("fa-plus"))}})}function openCard(e){if(e){let t=document.getElementById(e);if(t){t.classList.remove("collapsed-card");let n=t.querySelector(".card-body");n&&(n.style.display="block");let a=t.querySelector(".card-tools .btn-tool i");a&&(a.classList.remove("fa-plus"),a.classList.add("fa-minus"))}}}function getFocusableElements(){return Array.from(document.querySelectorAll('input:not([disabled]):not([type="hidden"]):not([data-exclude-apply]),select:not([disabled]):not([type="hidden"]):not([data-exclude-apply]),textarea:not([disabled]):not([type="hidden"]):not([data-exclude-apply])')).filter(e=>{let t=window.getComputedStyle(e);return"hidden"!==t.visibility&&"none"!==t.display&&e.offsetWidth>0&&e.offsetHeight>0})}function handleEnterAsTab(e){if("Enter"===e.key){e.preventDefault();let t=e.target,n=t.getAttribute("data-next-element-id"),a=t.getAttribute("data-function-before-navigation"),l=[],r=t.getAttribute("data-function-parameters");if(r)try{l=JSON.parse(r.replace(/'/g,'"'))}catch(i){h.error("Error parsing function parameters:",i)}a&&actionFunctions[a]&&actionFunctions[a](...l);let o;if(n)o=document.getElementById(n);else{let s=getFocusableElements(),c=s.indexOf(t);o=s[c+1]||s[0]}o&&(o.focus(),o instanceof HTMLInputElement&&["text","search","url","tel","password"].includes(o.type)&&o.select())}}function handleNumberInput(){h("input[hbnumber]").on("input",e=>{let t=e.target,n=toDecimal(t.value),a=t.hasAttribute("max")?toDecimal(t.max):null,l=t.hasAttribute("min")?toDecimal(t.min):null;""!==t.value&&!isNaN(n)&&(null!==a&&n>a&&(t.value=a),null!==l&&n<l&&(t.value=l))})}function initImageUpload(){let e=h(".hb-image-upload"),t=e.find(".hb-image-preview"),n=e.find('input[type="file"]'),a=t.data("placeholder"),l=null;function r(e){l&&URL.revokeObjectURL(l),l=e instanceof Blob?URL.createObjectURL(e):e,t.attr("src",l)}function i(){l&&(URL.revokeObjectURL(l),l=null),t.attr("src",a)}i(),n.on("change",function(e){let t=e.target.files[0];t?r(t):i()}),t.on("dragover",function(e){let a=n.next("label");if(a.is(":hidden")){e.preventDefault();return}e.preventDefault(),t.addClass("hb-dragover")}),t.on("drop",function(e){let a=n.next("label");if(a.is(":hidden")){e.preventDefault();return}e.preventDefault(),t.removeClass("hb-dragover");let l=e?.originalEvent?.dataTransfer?.files[0];l&&l.type.startsWith("image/")&&(r(l),n.prop("files",e.originalEvent.dataTransfer.files))})}function initMultiHBFiles(e="hb-file-input"){var t;let n=document.getElementById("hb-dropArea"),a=document.getElementById(e),l=document.getElementById("hb-selectFilesBtn"),r=document.getElementById("hb-previewContainer"),i=document.querySelector(".hb-file-input-container"),o=JSON.parse(r.getAttribute("hb-files")||"[]"),s=document.getElementById("hb-fullscreenModal"),c=document.getElementById("hb-modalContent"),d=document.getElementById("hb-fileDetails"),u=document.getElementById("hb-closeModal"),f=document.getElementById("hb-dragHandle"),m=[],p=new Set;function g(e){e.preventDefault(),e.stopPropagation()}function b(){n.classList.add("highlight")}function y(){n.classList.remove("highlight")}function v(){s.style.display="none",c.innerHTML="",u.style.top="15px",u.style.left="auto",u.style.right="15px",d.style.top="auto",d.style.left="0",d.style.right="0",d.style.bottom="15px",document.body.classList.remove("hb-body-no-scroll")}function x(e){return`${e.name}-${e.size}`}function E(e){if(!e.length)return;let t=e.filter(e=>{let t=x(e);return!p.has(t)&&(p.add(t),!0)});0!==t.length&&(m=[...m,...t],t.forEach(e=>{C(e)}),_())}function _(){try{let e=new DataTransfer;m.forEach(t=>{e.items.add(t)}),a.files=e.files,h.log(`Input actualizado con ${a.files.length} archivos.`)}catch(t){h.error("Error al actualizar el input de archivo:",t)}}function C(e,t=null){var n;let a=x(e),l=document.createElement("div");if(l.className="hb-preview-item",l.id=`hb-preview-${a}`,l.dataset.filename=e.name,null!==t){let o=document.createElement("input");o.type="hidden",o.name=`FilesToKeep[${t}]`,o.value=e.name,o.className="file-to-keep",l.appendChild(o)}if(!i.hasAttribute("hidden")){let s=document.createElement("button");s.type="button",s.className="hb-delete-button",s.innerHTML='<i class="fas fa-times"></i>',s.addEventListener("click",function(e){e.stopPropagation(),m=m.filter(e=>x(e)!==a),p.delete(a),l.remove(),_(),function e(){let t=document.querySelectorAll(".file-to-keep");t.forEach((e,t)=>{e.name=`FilesToKeep[${t}]`})}()}),l.appendChild(s)}let c=(n=e,["image/","application/pdf","video/","audio/","text/",].some(e=>n.type.startsWith(e)));if(c){let d=document.createElement("button");d.type="button",d.className="hb-fullscreen-button",d.innerHTML='<i class="fas fa-expand"></i>',d.addEventListener("click",function(t){t.stopPropagation(),L(e)}),l.appendChild(d)}else{let u=document.createElement("a");u.className="hb-fullscreen-button",u.innerHTML='<i class="fas fa-download"></i>',u.href=URL.createObjectURL(e),u.download=e.name,u.addEventListener("click",function(e){e.stopPropagation()}),l.appendChild(u)}let f;if(e.type.startsWith("image/")){let g=document.createElement("img");g.src=URL.createObjectURL(e),f=g}else{let b=document.createElement("div");b.className="hb-file-icon";let y="fas fa-file";e.type.includes("pdf")?y="fas fa-file-pdf":e.type.includes("word")||e.name.endsWith(".doc")||e.name.endsWith(".docx")?y="fas fa-file-word":e.type.includes("excel")||e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?y="fas fa-file-excel":e.type.includes("video")?y="fas fa-file-video":e.type.includes("audio")?y="fas fa-file-audio":e.type.includes("zip")||e.type.includes("rar")||e.type.includes("archive")?y="fas fa-file-archive":e.type.includes("text")&&(y="fas fa-file-alt");let v=document.createElement("i");v.className=y,b.appendChild(v);let E=document.createElement("span");E.textContent=function e(t){if(t.type){if(t.type.includes("spreadsheetml")||t.type.includes("excel"))return"EXCEL";if(t.type.includes("wordprocessingml")||t.type.includes("document"))return"WORD";if(t.type.includes("presentationml")||t.type.includes("powerpoint"))return"POWERPOINT";let n=t.type.split("/");return n.length>1?n[1].toUpperCase():n[0].toUpperCase()}let a=t.name.split(".").pop().toLowerCase();return({pdf:"PDF",doc:"WORD",docx:"WORD",xls:"EXCEL",xlsx:"EXCEL",ppt:"POWERPOINT",pptx:"POWERPOINT",zip:"ZIP",rar:"RAR",txt:"TEXT"})[a]||"FILE"}(e),b.appendChild(E),f=b}l.appendChild(f);let C=document.createElement("div");C.className="hb-file-name",C.textContent=e.name,C.title=e.name,l.appendChild(C),c?l.addEventListener("click",function(){L(e)}):l.addEventListener("click",function(){let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t)}),r.appendChild(l)}function L(e){if(c.innerHTML="",u.style.top="15px",u.style.left="auto",u.style.right="15px",d.style.top="auto",d.style.left="0",d.style.right="0",d.style.bottom="15px",d.textContent=`${e.name} (${function e(t){if(0===t)return"0 Bytes";let n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][n]}(e.size)})`,e.type.startsWith("image/")){let t=document.createElement("img");t.src=URL.createObjectURL(e),c.appendChild(t)}else if("application/pdf"===e.type){let n=document.createElement("div");n.className="hb-pdf-container";let a=document.createElement("iframe");a.src=URL.createObjectURL(e),n.appendChild(a),c.appendChild(n)}else if(e.type.startsWith("video/")){let l=document.createElement("video");l.controls=!0,l.autoplay=!1,l.style.maxWidth="95%",l.style.maxHeight="95%";let r=document.createElement("source");r.src=URL.createObjectURL(e),r.type=e.type,l.appendChild(r),c.appendChild(l)}else if(e.type.startsWith("audio/")){let i=document.createElement("div");i.style.width="80%",i.style.maxWidth="600px",i.style.backgroundColor="rgba(255, 255, 255, 0.1)",i.style.padding="20px",i.style.borderRadius="10px";let o=document.createElement("audio");o.controls=!0,o.style.width="100%";let f=document.createElement("source");f.src=URL.createObjectURL(e),f.type=e.type,o.appendChild(f),i.appendChild(o),c.appendChild(i)}else if(e.type.startsWith("text/")){let m=document.createElement("div");m.style.width="90%",m.style.height="90%",m.style.backgroundColor="white",m.style.padding="20px",m.style.borderRadius="8px",m.style.overflow="auto";let p=new FileReader;p.onload=function(e){let t=document.createElement("pre");t.style.textAlign="left",t.style.whiteSpace="pre-wrap",t.style.wordBreak="break-word",t.textContent=e.target.result,m.appendChild(t)},p.readAsText(e),c.appendChild(m)}else{let g=document.createElement("div");g.className="hb-file-preview";let b=document.createElement("p");b.textContent="Este tipo de archivo no se puede previsualizar directamente en el navegador.",b.style.marginBottom="20px",g.appendChild(b);let y=document.createElement("button");y.type="button",y.className="hb-external-open-button",y.innerHTML='<i class="fas fa-external-link-alt"></i> Abrir en nueva ventana',y.addEventListener("click",function(){let t=URL.createObjectURL(e);window.open(t,"_blank")}),g.appendChild(y),c.appendChild(g)}document.body.classList.add("hb-body-no-scroll"),s.style.display="flex"}!function e(){if(!o||0===o.length)return;r.removeAttribute("hb-files");let t=document.querySelector(".hb-loading-indicator");t&&t.remove();let n=document.createElement("div");n.style.width="100%",n.style.marginBottom="20px",r.parentNode.insertBefore(n,r);let a=document.createElement("div");a.className="hb-loading-indicator",a.innerHTML=`
    <div class="hb-spinner"></div>
    <p>Cargando archivos, por favor espere...</p>
    <p class="hb-loading-count">0/${o.length} archivos cargados</p>
  `,n.appendChild(a);let l=0,i=a.querySelector(".hb-loading-count"),s=o.map((e,t)=>{let n=new Date(e.LastModified);return fetch(e?.url).then(e=>e.blob()).then(a=>{let r=new File([a],e?.fileName,{type:a.type,lastModified:n.getTime()}),s=x(r);p.has(s)||(m.push(r),p.add(s),C(r,t)),l++,i.textContent=`${l}/${o.length} archivos cargados`}).catch(t=>{console.error(`Error al cargar el archivo existente ${e?.fileName}:`,t),l++,i.textContent=`${l}/${o.length} archivos cargados`})});Promise.all(s).finally(()=>{n.remove(),_()})}(),l.addEventListener("click",function(){a.click()}),a.addEventListener("change",function(e){e.target.files.length>0&&E(Array.from(e.target.files))}),["dragenter","dragover","dragleave","drop"].forEach(e=>{n.addEventListener(e,g,!1)}),["dragenter","dragover"].forEach(e=>{n.addEventListener(e,b,!1)}),["dragleave","drop"].forEach(e=>{n.addEventListener(e,y,!1)}),n.addEventListener("drop",function(e){let t=e.dataTransfer,n=t.files;E(Array.from(n))}),window.getUploadedFiles=function(){return m},d.style.cursor="ns-resize",d.style.zIndex="102";let T,w,A,k,q;T=!1,w=0,A=0,k=0,q=0,f.addEventListener("mousedown",function(e){document.body.style.userSelect="none",T=!1,w=e.clientX,A=e.clientY;let t=u.getBoundingClientRect(),n=s.getBoundingClientRect();k=w-t.left,q=A-t.top;let a=e=>{let a=e.clientX-w,l=e.clientY-A;if(Math.abs(a)>5||Math.abs(l)>5){T=!0;let r=Math.min(Math.max(0,e.clientX-n.left-k),n.width-t.width),i=Math.min(Math.max(0,e.clientY-n.top-q),n.height-t.height);u.style.left=`${r}px`,u.style.top=`${i}px`,u.style.right="auto"}},l=()=>{T||v(),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),document.body.style.userSelect=""};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)}),f.addEventListener("touchstart",function(e){if(document.body.style.userSelect="none",1!==e.touches.length)return;T=!1,w=e.touches[0].clientX,A=e.touches[0].clientY;let t=u.getBoundingClientRect(),n=s.getBoundingClientRect();k=w-t.left,q=A-t.top;let a=e=>{let a=e.touches[0].clientX-w,l=e.touches[0].clientY-A;if(Math.abs(a)>5||Math.abs(l)>5){T=!0;let r=Math.min(Math.max(0,e.touches[0].clientX-n.left-k),n.width-t.width),i=Math.min(Math.max(0,e.touches[0].clientY-n.top-q),n.height-t.height);u.style.left=`${r}px`,u.style.top=`${i}px`,u.style.right="auto"}},l=()=>{T||v(),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",l),document.body.style.userSelect=""};document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",l)});let B,S;B=!1,(t=d).addEventListener("mousedown",function(e){B=!0,S=e.clientY-t.getBoundingClientRect().top,e.preventDefault()}),document.addEventListener("mousemove",function(e){if(B&&t===document.getElementById("hb-fileDetails")){let n=e.clientY-S,a=window.innerHeight-t.offsetHeight;t.style.bottom="auto",t.style.top=`${Math.min(Math.max(0,n),a)}px`}}),document.addEventListener("mouseup",function(){B=!1}),t.addEventListener("touchstart",function(e){B=!0,S=e.touches[0].clientY-t.getBoundingClientRect().top,e.preventDefault()}),document.addEventListener("touchmove",function(e){if(B&&t===document.getElementById("hb-fileDetails")){let n=e.touches[0].clientY-S,a=window.innerHeight-t.offsetHeight;t.style.bottom="auto",t.style.top=`${Math.min(Math.max(0,n),a)}px`}},{passive:!1}),document.addEventListener("touchend",function(){B=!1})}class HBFormValidator{constructor(e={}){this.config={focusOnInvalid:!1,showErrors:!0,onError:null,...e},this.validateFields=this.validateFields.bind(this),this.showFieldError=this.showFieldError.bind(this)}validateFields(e){let t={...this.config,selectors:[],...e},n=[],a=[];"function"==typeof t.selectors?a=t.selectors():"string"==typeof t.selectors?a=[t.selectors]:Array.isArray(t.selectors)&&(a=t.selectors);let l=a.every(e=>{let a=$(e),l=a.val(),r=a.prop("type"),i=a.attr("name")||a.attr("id")||e,o=!0,s="";if(0===a.length)return console.error(`Campo '${e}' no encontrado en el DOM`),!1;if(a.prop("disabled")||a.prop("readonly"))return!0;let c=void 0!==a.attr("hb-required")||a.hasClass("hb-required")||a.closest(".form-group").find(".required-mark").length>0;if(c&&(null===l||""===l.trim())&&(o=!1,s=`El campo ${i} es obligatorio`),!o)return t.focusOnInvalid&&a.focus(),n.push({field:i,message:s,element:a}),!1;if(null===l||""===l.trim())return!0;switch(r){case"number":case"range":let d=toDecimal(l),u=void 0!==a.attr("min")?parseFloat(a.attr("min")):null,f=void 0!==a.attr("max")?parseFloat(a.attr("max")):null,m=void 0!==a.attr("step")?parseFloat(a.attr("step")):null;if(isNaN(d))o=!1,s=`El campo ${i} debe ser un n\xfamero v\xe1lido`;else if(null!==u&&d<u)o=!1,s=`El valor debe ser mayor o igual a ${u}`;else if(null!==f&&d>f)o=!1,s=`El valor debe ser menor o igual a ${f}`;else if(null!==m&&m>0){let p=(d-(null!==u?u:0))%m;p>0&&Math.abs(p-m)>1e-5&&(o=!1,s=`El valor debe ser un m\xfaltiplo de ${m} desde ${null!==u?u:0}`)}break;case"date":case"datetime":case"datetime-local":case"month":case"week":case"time":let g,b;if("date"===r?g="YYYY-MM-DD":"datetime"===r||"datetime-local"===r?g="YYYY-MM-DDTHH:mm:ss":"month"===r?g="YYYY-MM":"week"===r?g="YYYY-[W]WW":"time"===r&&(g="HH:mm"),(b=moment(l,g)).isValid()){let y=a.attr("min")?moment(a.attr("min"),g):null;null!==y&&y.isValid()&&b.isBefore(y)&&(o=!1,s=`La fecha debe ser igual o posterior a ${y.format(g)}`);let v=a.attr("max")?moment(a.attr("max"),g):null;null!==v&&v.isValid()&&b.isAfter(v)&&(o=!1,s=`La fecha debe ser igual o anterior a ${v.format(g)}`)}else o=!1,s=`El formato de fecha/hora no es v\xe1lido`;break;case"email":let x=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;if(x.test(l)||(o=!1,s=`El email no tiene un formato v\xe1lido`),o&&void 0!==a.attr("multiple")){let E=l.split(/\s*,\s*/);for(let _ of E)if(!x.test(_)){o=!1,s=`Uno o m\xe1s emails no tienen un formato v\xe1lido`;break}}break;case"url":try{new URL(l)}catch(C){o=!1,s=`La URL no tiene un formato v\xe1lido`}break;case"tel":let L=a.attr("pattern")||/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/;"string"==typeof L?RegExp(L).test(l)||(o=!1,s=`El tel\xe9fono no tiene un formato v\xe1lido`):L.test(l)||(o=!1,s=`El tel\xe9fono no tiene un formato v\xe1lido`);break;case"password":let T=a.attr("minlength")?parseInt(a.attr("minlength")):8,w=a.attr("data-strength-pattern")||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;l.length<T?(o=!1,s=`La contrase\xf1a debe tener al menos ${T} caracteres`):a.attr("data-validate-strength")&&"string"==typeof w&&!RegExp(w).test(l)&&(o=!1,s=a.attr("data-strength-message")||`La contrase\xf1a debe incluir may\xfasculas, min\xfasculas, n\xfameros y caracteres especiales`);let A=a.attr("data-match-field");if(A){let k=h(A).val();l!==k&&(o=!1,s=`Las contrase\xf1as no coinciden`)}break;case"file":let q=a[0].files;if(c&&(!q||0===q.length))o=!1,s="Debe seleccionar un archivo";else if(q&&q.length>0){let B=a.attr("data-max-files")?parseInt(a.attr("data-max-files")):a.attr("multiple")?null:1;null!==B&&q.length>B&&(o=!1,s=`Puede seleccionar m\xe1ximo ${B} archivo(s)`);let S=a.attr("accept");if(S){let I=S.split(",").map(e=>e.trim().toLowerCase());for(let F=0;F<q.length;F++){let D=q[F],M=!1;for(let R of I)if(R.startsWith(".")){let H="."+D.name.split(".").pop().toLowerCase();if(H===R){M=!0;break}}else if(R.includes("/")){let[z,O]=R.split("/"),[P,N]=D.type.split("/");if(("*"===z||P===z)&&("*"===O||N===O)){M=!0;break}}if(!M){o=!1,s=`Uno o m\xe1s archivos no tienen un formato permitido`;break}}}let W=a.attr("data-max-size")?parseInt(a.attr("data-max-size")):null;if(null!==W){for(let U=0;U<q.length;U++)if(q[U].size>W){o=!1;let Y=Math.round(W/1048576*100)/100;s=`El tama\xf1o m\xe1ximo por archivo es de ${Y} MB`;break}}}break;case"checkbox":c&&!a.prop("checked")&&(o=!1,s="Este campo es obligatorio");let j=a.attr("data-group");if(j){let V=a.attr("data-min-checked")?parseInt(a.attr("data-min-checked")):null,X=a.attr("data-max-checked")?parseInt(a.attr("data-max-checked")):null;if(null!==V||null!==X){let Z=document.querySelectorAll(`input[type="checkbox"][data-group="${j}"]:checked`).length;null!==V&&Z<V?(o=!1,s=`Debe seleccionar al menos ${V} opciones`):null!==X&&Z>X&&(o=!1,s=`Puede seleccionar m\xe1ximo ${X} opciones`)}}break;case"radio":if(c){let G=a.attr("name"),Q=document.querySelector(`input[type="radio"][name="${G}"]:checked`);Q||(o=!1,s=`Debe seleccionar una opci\xf3n`)}break;default:let K=a.attr("minlength")?parseInt(a.attr("minlength")):null,J=a.attr("maxlength")?parseInt(a.attr("maxlength")):null;null!==K&&l.length<K?(o=!1,s=`Debe tener al menos ${K} caracteres`):null!==J&&l.length>J&&(o=!1,s=`Debe tener m\xe1ximo ${J} caracteres`);let ee=a.attr("pattern");ee&&!RegExp(`^${ee}$`).test(l)&&(o=!1,s=a.attr("title")||`El formato no es v\xe1lido`);let et=a.attr("list");if(et){let en=document.getElementById(et);if(en){let ea=Array.from(en.querySelectorAll("option")).map(e=>e.value);!ea.includes(l)&&a.attr("data-strict-datalist")&&(o=!1,s="Debe seleccionar un valor de la lista")}}if(a.attr("data-validation-function"))try{let el=Function("value","element",a.attr("data-validation-function")),er=el(l,a[0]);!0!==er&&(o=!1,s="string"==typeof er?er:a.attr("data-validation-message")||`Validaci\xf3n personalizada fallida`)}catch(ei){console.error(`Error en la validaci\xf3n personalizada del campo ${i}:`,ei)}}return o&&a[0]&&"function"==typeof a[0].checkValidity&&!a[0].checkValidity()&&(o=!1,s=a[0].validationMessage||`El campo no es v\xe1lido`),!!o||(n.push({field:i,message:s,element:a}),t.focusOnInvalid&&a.focus(),t.showErrors&&this.showFieldError(a,s),!1)});return!l&&n.length>0&&"function"==typeof t.onError&&t.onError(n),l}areFieldsValid(e,t=!1){return this.validateFields({selectors:e,focusOnInvalid:t})}showFieldError(e,t){let n=e.closest(".form-group");n.find(".validation-error").remove(),e.addClass("is-invalid");let a=$(`<div class="validation-error text-danger small mt-1">${t}</div>`);n.find("label").length>0?a.insertAfter(e):n.append(a),e.one("input change",function(){e.removeClass("is-invalid"),n.find(".validation-error").fadeOut(300,function(){$(this).remove()})})}static create(e={}){return new HBFormValidator(e)}}function createInputField({type:e,className:t,name:n,value:a,min:l,max:r,readonly:i}){e=e?escapeHTML(e):"text",t=t?escapeHTML(t):"",n=n?escapeHTML(n):"",a=null!=a?escapeHTML(a.toString()):"";let o=`<input type="${e}"`;return t&&(o+=` class="${t}"`),n&&(o+=` name="${n}"`),""!==a&&(o+=` value="${a}"`),void 0!==l&&(o+=` min="${l}"`),void 0!==r&&(o+=` max="${r}"`),i&&(o+=' readonly="readonly"'),o+=">"}function escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function reindexTable(e,t){h(`#${e} tr`).each(function(e,n){h(n).find(`input[name^="${t}["]`).each(function(){let n=h(this).attr("name"),a=n.replace(RegExp(`${t}\\[\\d+\\]`),`${t}[${e}]`);h(this).attr("name",a)})})}function generatehbqrs(){if("function"!=typeof hbqr){console.warn("hbqr-generator no est\xe1 disponible. \xbfOlvidaste cargar hbqr.js?");return}h("[hbQR]").each(function(){let e=h(this),t=e.attr("hbQR"),n=parseInt(e.attr("size"))||200,a=e.attr("level")||"M",l=hbqr(0,a);l.addData(t),l.make();let r=l.createImgTag(Math.max(1,Math.floor(n/25)));e.html(r)})}